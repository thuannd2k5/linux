{% extends "base.html" %}

{% block content %}
<h3>ğŸ“ SFTP File Manager</h3>

<div class="info-box">
    <p><b>Server:</b> {{ server.ip }}</p>
    <p><b>Current Path:</b> <code style="background: #fff; padding: 5px 10px; border-radius: 5px;">{{ path }}</code></p>
</div>

<div class="action-links">
    <a href="/search/{{ server_id }}?path={{ path }}">ğŸ” Search in this folder</a>
    <a href="/bookmark/{{ server_id }}?path={{ path }}">â­ Bookmark this folder</a>
</div>

<hr>

<h4>ğŸ“¤ Upload File</h4>
<form method="POST"
      action="/upload/{{ server_id }}"
      enctype="multipart/form-data">
    <input type="hidden" name="path" value="{{ path }}">
    <div style="display: flex; gap: 10px; align-items: center;">
        <input type="file" name="file" required style="flex: 1;">
        <button type="submit">Upload</button>
    </div>
</form>

<hr>

<h4>ğŸ“‚ Files and Folders</h4>

<table>
    <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Action</th>
    </tr>

    {% if files %}
        {% for f in files %}
        <tr>
            <td>
                {% if f.is_dir %}
                    <span class="folder-icon"></span>
                    <a href="/sftp/{{ server_id }}?path={{ path }}/{{ f.name }}">
                        {{ f.name }}
                    </a>
                {% else %}
                    <span class="file-icon"></span>
                    {{ f.name }}
                {% endif %}
            </td>

            <td>
                {% if f.is_dir %}
                    <span style="color: #667eea; font-weight: 600;">Folder</span>
                {% else %}
                    <span style="color: #666;">File</span>
                {% endif %}
            </td>

            <td>
                {% if not f.is_dir %}
                    <a href="/download/{{ server_id }}?path={{ path }}/{{ f.name }}">Download</a>
                    |
                    <a href="/delete/{{ server_id }}?path={{ path }}/{{ f.name }}&current={{ path }}"
                       onclick="return confirm('Are you sure you want to delete this file?');">
                       Delete
                    </a>
                {% else %}
                    <span style="color: #ccc;">â€”</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    {% else %}
        <tr>
            <td colspan="3" style="text-align: center; color: #999; padding: 30px;">
                ğŸ“­ This folder is empty
            </td>
        </tr>
    {% endif %}
</table>

<br>
<a href="/servers" class="back-link">â† Back to Servers</a>
{% endblock %}